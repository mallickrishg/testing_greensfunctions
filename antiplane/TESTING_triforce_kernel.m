
clear

mu = 1;

Nxobs = 100;
Nyobs = 100;
xval = linspace(-2,2,Nxobs);
yval = linspace(-2,2,Nyobs)';
[xgrid,ygrid] = meshgrid(xval,yval);
x = xgrid(:);
y = ygrid(:);

% source is integrated over a triangle region given by 
% a triangular region ABC:
% A(0,0), B(w,q), B(0,l)

u = @(w,l) (1/4).*l.^(-1).*pi.^(-1).*abs(l.*w).*((-1).*l+w.^(-1).*(w.* ...
  y+(w.^2+(-2).*w.*x+(-1).*x.^2+y.^2).*atan2(y, w+(-1).*x)+(( ...
  -1).*x.^2+y.^2).*atan2(y, x)+(-2).*x.^2.*atan2(w+(-1).*x, y) ...
  +(-2).*x.^2.*atan2(x, y))+w.^(-1).*y.*((-2).*w+2.*y.*(atan2( ...
  w+(-1).*x, y)+atan2(x, y))+(w+(-1).*x).*log((w+(-1).*x).^2+ ...
  y.^2)+x.*log(x.^2+y.^2))+(-1).*(l.^2+w.^2).^(-2).*((-1).* ...
  l.^3.*w.^2+(-1).*l.*w.^4+l.^3.*w.*x+l.*w.^3.*x+l.^2.*w.^2.* ...
  y+w.^4.*y+(l.^2+w.^2).^2.*(w+(-2).*x).*atan2(y, w+(-1).*x)+( ...
  l.^4.*(w+(-2).*x)+2.*l.*w.^2.*(w+(-1).*x).*y+2.*l.^3.*((-1) ...
  .*w+x).*y+l.^2.*w.*((-1).*w.^2+2.*w.*x+(-3).*x.^2+y.^2)+(-1) ...
  .*w.^3.*(x.^2+y.^2)).*atan2(l.*w+(-1).*l.*x+(-1).*w.*y,  ...
  l.^2+w.*x+(-1).*l.*y)+l.^4.*w.*atan2(l.*w+(-1).*l.*x+(-1).* ...
  w.*y, w.^2+(-1).*w.*x+l.*y)+(-1).*l.^2.*w.^3.*atan2(l.*w+( ...
  -1).*l.*x+(-1).*w.*y, w.^2+(-1).*w.*x+l.*y)+(-2).*l.^4.*x.* ...
  atan2(l.*w+(-1).*l.*x+(-1).*w.*y, w.^2+(-1).*w.*x+l.*y)+2.* ...
  l.^2.*w.^2.*x.*atan2(l.*w+(-1).*l.*x+(-1).*w.*y, w.^2+(-1).* ...
  w.*x+l.*y)+(-3).*l.^2.*w.*x.^2.*atan2(l.*w+(-1).*l.*x+(-1).* ...
  w.*y, w.^2+(-1).*w.*x+l.*y)+(-1).*w.^3.*x.^2.*atan2(l.*w+( ...
  -1).*l.*x+(-1).*w.*y, w.^2+(-1).*w.*x+l.*y)+(-2).*l.^3.*w.* ...
  y.*atan2(l.*w+(-1).*l.*x+(-1).*w.*y, w.^2+(-1).*w.*x+l.*y)+ ...
  2.*l.*w.^3.*y.*atan2(l.*w+(-1).*l.*x+(-1).*w.*y, w.^2+(-1).* ...
  w.*x+l.*y)+2.*l.^3.*x.*y.*atan2(l.*w+(-1).*l.*x+(-1).*w.*y,  ...
  w.^2+(-1).*w.*x+l.*y)+(-2).*l.*w.^2.*x.*y.*atan2(l.*w+(-1).* ...
  l.*x+(-1).*w.*y, w.^2+(-1).*w.*x+l.*y)+l.^2.*w.*y.^2.*atan2( ...
  l.*w+(-1).*l.*x+(-1).*w.*y, w.^2+(-1).*w.*x+l.*y)+(-1).* ...
  w.^3.*y.^2.*atan2(l.*w+(-1).*l.*x+(-1).*w.*y, w.^2+(-1).*w.* ...
  x+l.*y)+(-1).*l.^3.*w.^2.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+2.* ...
  l.^3.*w.*x.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+(-1).*l.^3.* ...
  x.^2.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+2.*l.^2.*w.^2.*y.*log( ...
  w.^2+(-2).*w.*x+x.^2+y.^2)+(-2).*l.^2.*w.*x.*y.*log(w.^2+( ...
  -2).*w.*x+x.^2+y.^2)+(-1).*l.*w.^2.*y.^2.*log(w.^2+(-2).*w.* ...
  x+x.^2+y.^2)+l.^3.*w.^2.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+(-2) ...
  .*l.^3.*w.*x.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+l.^3.*x.^2.* ...
  log(l.^2+x.^2+(-2).*l.*y+y.^2)+(-2).*l.^2.*w.^2.*y.*log( ...
  l.^2+x.^2+(-2).*l.*y+y.^2)+2.*l.^2.*w.*x.*y.*log(l.^2+x.^2+( ...
  -2).*l.*y+y.^2)+l.*w.^2.*y.^2.*log(l.^2+x.^2+(-2).*l.*y+ ...
  y.^2))+(1/2).*(l.^2+w.^2).^(-2).*((-1).*l.^5+(-4).*l.^3.* ...
  w.^2+(-3).*l.*w.^4+2.*l.^3.*w.*x+2.*l.*w.^3.*x+2.*l.^4.*y+ ...
  6.*l.^2.*w.^2.*y+4.*w.^4.*y+4.*w.*(l.*(w+(-1).*x)+(-1).*w.* ...
  y).^2.*atan2(l.^2+w.*x+(-1).*l.*y, l.*w+(-1).*l.*x+(-1).*w.* ...
  y)+4.*w.*((-1).*l.*w+l.*x+w.*y).^2.*atan2(w.^2+(-1).*w.*x+ ...
  l.*y, l.*w+(-1).*l.*x+(-1).*w.*y)+l.^5.*log(y.^2)+2.*l.^3.* ...
  w.^2.*log(y.^2)+l.*w.^4.*log(y.^2)+(-2).*l.^4.*y.*log(y.^2)+ ...
  (-4).*l.^2.*w.^2.*y.*log(y.^2)+(-2).*w.^4.*y.*log(y.^2)+(-1) ...
  .*l.^5.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+(-3).*l.^3.*w.^2.* ...
  log(w.^2+(-2).*w.*x+x.^2+y.^2)+2.*l.^3.*w.*x.*log(w.^2+(-2) ...
  .*w.*x+x.^2+y.^2)+(-2).*l.*w.^3.*x.*log(w.^2+(-2).*w.*x+ ...
  x.^2+y.^2)+(-1).*l.^3.*x.^2.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+ ...
  l.*w.^2.*x.^2.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+2.*l.^4.*y.* ...
  log(w.^2+(-2).*w.*x+x.^2+y.^2)+6.*l.^2.*w.^2.*y.*log(w.^2+( ...
  -2).*w.*x+x.^2+y.^2)+(-2).*l.^2.*w.*x.*y.*log(w.^2+(-2).*w.* ...
  x+x.^2+y.^2)+2.*w.^3.*x.*y.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+( ...
  -1).*l.^3.*y.^2.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+(-3).*l.* ...
  w.^2.*y.^2.*log(w.^2+(-2).*w.*x+x.^2+y.^2)+l.^5.*log(y.^(-2) ...
  .*(w.^2+(-2).*w.*x+x.^2+y.^2))+2.*l.^3.*w.^2.*log(y.^(-2).*( ...
  w.^2+(-2).*w.*x+x.^2+y.^2))+l.*w.^4.*log(y.^(-2).*(w.^2+(-2) ...
  .*w.*x+x.^2+y.^2))+(-2).*l.^4.*y.*log(y.^(-2).*(w.^2+(-2).* ...
  w.*x+x.^2+y.^2))+(-4).*l.^2.*w.^2.*y.*log(y.^(-2).*(w.^2+( ...
  -2).*w.*x+x.^2+y.^2))+(-2).*w.^4.*y.*log(y.^(-2).*(w.^2+(-2) ...
  .*w.*x+x.^2+y.^2))+l.^5.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+3.* ...
  l.^3.*w.^2.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+(-2).*l.^3.*w.* ...
  x.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+2.*l.*w.^3.*x.*log(l.^2+ ...
  x.^2+(-2).*l.*y+y.^2)+l.^3.*x.^2.*log(l.^2+x.^2+(-2).*l.*y+ ...
  y.^2)+(-1).*l.*w.^2.*x.^2.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+( ...
  -2).*l.^4.*y.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+(-6).*l.^2.* ...
  w.^2.*y.*log(l.^2+x.^2+(-2).*l.*y+y.^2)+2.*l.^2.*w.*x.*y.* ...
  log(l.^2+x.^2+(-2).*l.*y+y.^2)+(-2).*w.^3.*x.*y.*log(l.^2+ ...
  x.^2+(-2).*l.*y+y.^2)+l.^3.*y.^2.*log(l.^2+x.^2+(-2).*l.*y+ ...
  y.^2)+3.*l.*w.^2.*y.^2.*log(l.^2+x.^2+(-2).*l.*y+y.^2)));

ex = @(w,l) (-1/2).*pi.^(-1).*(x.*atan(x.*y.^(-1))+(-1/2).*y.*log(x.^2+y.^2))+ ...
  (1/2).*pi.^(-1).*(x.*atan(((-1).*w+x).*y.^(-1))+w.*atan(((-1).*w+ ...
  x).^(-1).*y)+(-1/2).*y.*log(w.^2+(-2).*w.*x+x.^2+y.^2))+(1/2).* ...
  pi.^(-1).*(x.*atan(x.*((-1).*l+w.^(-1).*x+y).^(-1))+(1/2).*(l+(-1) ...
  .*w.^(-1).*x+(-1).*y).*log(x.^2+((-1).*l+w.^(-1).*x+y).^2))+(-1/2) ...
  .*pi.^(-1).*(x.*atan(((-1).*w+x).*((-1).*l+w.^(-1).*x+y).^(-1))+ ...
  w.*atan(((-1).*w+x).^(-1).*((-1).*l+w.^(-1).*x+y))+(1/2).*(l+(-1) ...
  .*w.^(-1).*x+(-1).*y).*log(w.^2+(-2).*w.*x+x.^2+((-1).*l+w.^(-1).* ...
  x+y).^2));

ey = @(w,l) (1/4).*pi.^(-1).*(2.*y.*atan(x.*y.^(-1))+x.*log(x.^2+y.^2))+(-1/4) ...
  .*pi.^(-1).*(2.*w+2.*y.*atan(((-1).*w+x).*y.^(-1))+((-1).*w+x).* ...
  log(w.^2+(-2).*w.*x+x.^2+y.^2))+(-1/4).*pi.^(-1).*(2.*((-1).*l+ ...
  w.^(-1).*x+y).*atan(x.*((-1).*l+w.^(-1).*x+y).^(-1))+x.*log(x.^2+( ...
  (-1).*l+w.^(-1).*x+y).^2))+(1/4).*pi.^(-1).*(2.*w+2.*((-1).*l+w.^( ...
  -1).*x+y).*atan(((-1).*w+x).*((-1).*l+w.^(-1).*x+y).^(-1))+((-1).* ...
  w+x).*log(w.^2+(-2).*w.*x+x.^2+((-1).*l+w.^(-1).*x+y).^2));

% set vertices
% A(0,0), B(w,q), B(0,l)
w = 1;
q = 0;
l = 1;

% Displacements
figure(1),clf
toplot = ey(w,l)/(0.5*w*l);
pcolor(xval,yval,reshape(toplot,Nyobs,Nxobs)), shading interp
hold on
plot([0,w],[0,q],'k-','Linewidth',2)
plot([w,0],[q,l],'k-','Linewidth',2)
plot([0,0],[l,0],'k-','Linewidth',2)
hold on
colorbar
xlabel('x')
clim([-1 1]*0.5)
colormap(bluewhitered(20))
title('u','FontWeight','normal')
